<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Miski Chukulati ‚Äî Pedidos & Oraciones</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg-1: #3b2314;
    --bg-2: #5c3b1e;
    --accent-1: #c7a86d;
    --accent-2: #e5c99c;
    --card: rgba(255,255,255,0.08);
    --text-light: #f3e7cf;
    --text-dark: #3b2314;
    --success: #c7ffb2;
    --danger: #ffb2b2;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:'Poppins',sans-serif;
    background: linear-gradient(135deg,var(--bg-1),var(--bg-2));
    color:var(--text-light);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }
  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:14px 20px;
    background: rgba(0,0,0,0.06);
  }
  .brand {
    display:flex;
    align-items:center;
    gap:12px;
  }
  .brand img{width:56px;height:56px;border-radius:50%;object-fit:cover}
  .brand h1{font-size:1.1rem;margin:0;color:var(--text-light)}
  nav{display:flex;gap:8px;align-items:center}
  .tab-btn{
    background:transparent;
    border:0;
    color:var(--text-light);
    padding:8px 12px;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
  }
  .tab-btn.active{
    background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
    color:var(--text-dark);
  }
  .container{
    max-width:980px;
    margin:28px auto;
    padding:22px;
  }
  .card{
    background:var(--card);
    border-radius:12px;
    padding:20px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.2);
  }
  .grid{
    display:grid;
    grid-template-columns:1fr 320px;
    gap:20px;
  }
  @media(max-width:880px){
    .grid{grid-template-columns:1fr; padding-bottom:10px}
  }
  form{display:block}
  label{display:block;margin-top:12px;font-weight:600;color:var(--text-light)}
  input, select, textarea{
    width:100%;
    padding:10px;
    margin-top:6px;
    border-radius:8px;
    border:1px solid rgba(0,0,0,0.06);
    background: #fff;
    color:var(--text-dark);
    font-size:0.95rem;
  }
  button.primary{
    margin-top:18px;
    width:100%;
    padding:12px;
    border-radius:12px;
    border:0;
    background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
    color:var(--text-dark);
    font-weight:700;
    cursor:pointer;
    font-size:1rem;
  }
  .muted{color:#f6edde;font-style:italic}
  .msg{margin-top:12px;padding:12px;border-radius:8px}
  .msg.success{background: rgba(0,0,0,0.06); color:var(--success)}
  .msg.error{background: rgba(0,0,0,0.06); color:var(--danger)}
  .aside {
    padding:16px;
    border-radius:10px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    text-align:center;
    color:var(--text-light);
  }
  .aside h3{margin:0 0 8px 0}
  .link-track{
    display:inline-block;
    margin-top:12px;
    padding:10px 14px;
    border-radius:22px;
    background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
    color:var(--text-dark);
    text-decoration:none;
    font-weight:700;
  }
  /* small helpers */
  .row{display:flex;gap:12px}
  .row .col{flex:1}
  .verse{margin-top:14px;font-style:italic;color:#f1e8d8;font-size:0.95rem}
</style>
</head>
<body>

<header>
  <div class="brand">
    <img src="https://miskichukulati25-rgb.github.io/MiskiChukulati/assets/logo.png" alt="Logo">
    <div>
      <h1>Miski Chukulati</h1>
      <div class="muted">El sabor que une a la familia</div>
    </div>
  </div>

  <nav>
    <button class="tab-btn active" data-tab="pedido">üõçÔ∏è Haz tu Pedido</button>
    <button class="tab-btn" data-tab="seguimiento">üì¶ Seguimiento</button>
    <button class="tab-btn" data-tab="oracion">üôè Pedido de Oraci√≥n</button>
  </nav>
</header>

<main class="container">
  <div class="card">
    <div class="grid">

      <!-- LEFT: forms area -->
      <div id="formsArea">

        <!-- Pedido form -->
        <section id="pedido" class="tab-panel" style="display:block">
          <h2>Haz tu pedido</h2>
          <form id="pedidoForm">
            <div class="row">
              <div class="col">
                <label for="dni">DNI</label>
                <input id="dni" name="dni" maxlength="8" required placeholder="8 d√≠gitos">
              </div>
              <div class="col">
                <label for="nombre">Nombre completo</label>
                <input id="nombre" name="nombre" required placeholder="Tu nombre completo">
              </div>
            </div>

            <label for="correo">Correo electr√≥nico</label>
            <input id="correo" name="correo" type="email" required placeholder="ejemplo@correo.com">

            <div class="row">
              <div class="col">
                <label for="telefono">Tel√©fono (WhatsApp)</label>
                <input id="telefono" name="telefono" required placeholder="987654321">
              </div>
              <div class="col">
                <label for="producto">Producto</label>
                <select id="producto" name="producto" required>
                  <option value="">Selecciona un producto</option>
                  <option>Tableta 70 % cacao</option>
                  <option>Tableta 85 % cacao</option>
                  <option>Bombones surtidos</option>
                  <option>Dark Chocolate Bar</option>
                  <option>ChocoNibs</option>
                  <option>ChocoBites</option>
                  <option>Chocolate Blanco</option>
                </select>
              </div>
            </div>

            <div class="row">
              <div class="col">
                <label for="cantidad">Cantidad</label>
                <input id="cantidad" name="cantidad" type="number" min="1" value="1" required>
              </div>
              <div class="col">
                <label for="direccion">Direcci√≥n</label>
                <input id="direccion" name="direccion" placeholder="Direcci√≥n de entrega (opcional)">
              </div>
            </div>

            <label for="comentarios">Comentarios</label>
            <textarea id="comentarios" name="comentarios" rows="3" placeholder="Detalles, horario de entrega..."></textarea>

            <button class="primary" type="submit">Enviar pedido</button>

            <div id="pedidoMsg" class="msg" style="display:none"></div>
          </form>
        </section>

        <!-- Seguimiento panel (link) -->
        <section id="seguimiento" class="tab-panel" style="display:none">
          <h2>Seguimiento de pedidos</h2>
          <p class="muted">Puedes consultar el estado de tu pedido con el ID que recibir√°s en el correo.</p>
          <div style="margin-top:12px;">
            <a class="link-track" href="https://miskichukulati25-rgb.github.io/MiskiChukulati/tracking.html" target="_blank">Ir a Seguimiento</a>
          </div>
        </section>

        <!-- Oracion form -->
        <section id="oracion" class="tab-panel" style="display:none">
          <h2>Pedido de Oraci√≥n</h2>
          <p class="muted">Env√≠a tu petici√≥n y oraremos por ti y por tu intenci√≥n.</p>
          <form id="oracionForm">
            <label for="or_nombre">Nombre de quien ora</label>
            <input id="or_nombre" name="nombre" required placeholder="Tu nombre completo">

            <label for="or_porquien">Por qui√©n desea orar</label>
            <input id="or_porquien" name="porQuien" placeholder="Nombre de la persona (opcional)">

            <label for="or_pedido">Pedido / Motivo de oraci√≥n</label>
            <textarea id="or_pedido" name="pedido" rows="4" required placeholder="Escribe tu petici√≥n aqu√≠..."></textarea>

            <label for="or_correo">Correo (recibir√°s confirmaci√≥n)</label>
            <input id="or_correo" name="correo" type="email" placeholder="opcional@correo.com">

            <button class="primary" type="submit">Enviar Pedido de Oraci√≥n</button>

            <div id="oracionMsg" class="msg" style="display:none"></div>

            <div class="verse">Santiago 5:16 ‚Äî "Confesaos vuestras ofensas unos a otros, y orad unos por otros, para que se√°is sanados. La oraci√≥n eficaz del justo puede mucho."</div>
          </form>
        </section>

      </div>

      <!-- RIGHT: aside -->
      <aside class="aside">
        <h3>Contacto r√°pido</h3>
        <p>¬øNecesitas ayuda? Escr√≠benos por WhatsApp:</p>
        <a id="waQuick" class="link-track" href="#" target="_blank">üí¨ WhatsApp</a>

        <div style="margin-top:16px">
          <h3>Accesos</h3>
          <p style="font-size:0.95rem">Ver seguimiento o dudas sobre tu pedido</p>
          <a class="link-track" href="https://miskichukulati25-rgb.github.io/MiskiChukulati/tracking.html" target="_blank">Abrir seguimiento</a>
        </div>
      </aside>

    </div>
  </div>
</main>

<script>
/* ========== Config ========== */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbypicbViQpx68de35No3yAEd2XoLHOQ5banZ8cmJjn15es3eus8K4rTM8sRtFoPaDiH/exec";
const WA_DEFAULT = "https://wa.me/51YOURNUMBER?text="; // reemplaza YOURNUMBER si quieres link directo

/* ========== UI: tabs ========== */
document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const tab = btn.dataset.tab;
    document.querySelectorAll('.tab-panel').forEach(p=>{
      p.style.display = (p.id === tab) ? 'block' : 'none';
    });
    // scroll to top of container
    window.scrollTo({top:0,behavior:'smooth'});
  });
});

/* ========== Quick WhatsApp link (populate from phone field if available) ========== */
const waQuick = document.getElementById('waQuick');
function updateWaQuick(){
  const tel = document.getElementById('telefono')?.value.replace(/\D/g,'') || '';
  if(tel && tel.length>=8){
    let t = tel;
    if(t.length <= 8) t = '51' + t;
    waQuick.href = `https://wa.me/${t}`;
    waQuick.textContent = 'üí¨ WhatsApp: ' + t;
  } else {
    waQuick.href = '#';
    waQuick.textContent = 'üí¨ WhatsApp';
  }
}
document.getElementById('telefono')?.addEventListener('input', updateWaQuick);

/* ========== Pedido form handling ========== */
const pedidoForm = document.getElementById('pedidoForm');
const pedidoMsg = document.getElementById('pedidoMsg');

pedidoForm.addEventListener('submit', async (ev) => {
  ev.preventDefault();
  pedidoMsg.style.display = 'block';
  pedidoMsg.className = '';
  pedidoMsg.textContent = '‚è≥ Enviando pedido...';

  const formData = {
    tipo: 'pedido',
    dni: document.getElementById('dni').value.trim(),
    nombre: document.getElementById('nombre').value.trim(),
    correo: document.getElementById('correo').value.trim(),
    telefono: document.getElementById('telefono').value.trim(),
    producto: document.getElementById('producto').value,
    cantidad: document.getElementById('cantidad').value,
    direccion: document.getElementById('direccion').value.trim(),
    comentarios: document.getElementById('comentarios').value.trim()
  };

  try{
    const res = await fetch(SCRIPT_URL, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(formData)
    });
    const json = await res.json();
    if(json.success){
      pedidoMsg.className = 'msg success';
      pedidoMsg.innerHTML = `‚úÖ Pedido <strong>${json.idPedido}</strong> registrado. Revisa tu correo para el comprobante.<br>
                             <a style="color:#ffd27f" href="${json.pdfUrl || json.trackingUrl || '#'}" target="_blank">Abrir comprobante / seguimiento</a>`;
      pedidoForm.reset();
      updateWaQuick();
    } else {
      pedidoMsg.className = 'msg error';
      pedidoMsg.textContent = '‚ùå ' + (json.error || 'No se pudo registrar el pedido.');
    }
  }catch(err){
    console.error(err);
    pedidoMsg.className = 'msg error';
    pedidoMsg.textContent = '‚ö†Ô∏è Error de conexi√≥n. Intenta nuevamente.';
  }
});

/* ========== Oracion form handling ========== */
const oracionForm = document.getElementById('oracionForm');
const oracionMsg = document.getElementById('oracionMsg');

oracionForm.addEventListener('submit', async (ev) => {
  ev.preventDefault();
  oracionMsg.style.display = 'block';
  oracionMsg.className = '';
  oracionMsg.textContent = '‚è≥ Enviando pedido de oraci√≥n...';

  const formData = {
    tipo: 'oracion',
    nombre: document.getElementById('or_nombre').value.trim(),
    porQuien: document.getElementById('or_porquien').value.trim(),
    pedido: document.getElementById('or_pedido').value.trim(),
    correo: document.getElementById('or_correo').value.trim()
  };

  try {
    const res = await fetch(SCRIPT_URL, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(formData)
    });
    const json = await res.json();
    if(json.success){
      oracionMsg.className = 'msg success';
      oracionMsg.innerHTML = `‚úÖ Pedido de oraci√≥n registrado. Gracias ‚Äî oraremos por tu petici√≥n.<br>
                              <div style="margin-top:8px;font-style:italic;color:#f1e8d8">
                              Santiago 5:16 ‚Äî "Confesaos vuestras ofensas unos a otros, y orad unos por otros, para que se√°is sanados. La oraci√≥n eficaz del justo puede mucho."
                              </div>`;
      oracionForm.reset();
      // keep user on the oracion tab and show verse
    } else {
      oracionMsg.className = 'msg error';
      oracionMsg.textContent = '‚ùå ' + (json.error || 'No se pudo enviar el pedido de oraci√≥n.');
    }
  } catch(err){
    console.error(err);
    oracionMsg.className = 'msg error';
    oracionMsg.textContent = '‚ö†Ô∏è Error de conexi√≥n. Intenta nuevamente.';
  }
});

/* ========== Auto-open tab if ?tab=oracion or ?id=... in URL ========== */
(function handleQueryParams(){
  try {
    const params = new URLSearchParams(window.location.search);
    const tab = params.get('tab');
    const id = params.get('id');
    if(tab === 'oracion'){
      document.querySelector('[data-tab="oracion"]').click();
      setTimeout(()=>document.getElementById('or_nombre')?.focus(),350);
    } else if(tab === 'seguimiento'){
      document.querySelector('[data-tab="seguimiento"]').click();
    } else if(id){
      // If id param present, switch to seguimiento for instructions
      document.querySelector('[data-tab="seguimiento"]').click();
      // optionally pre-fill tracking URL or show instructions
    }
  } catch(e){}
})();
</script>
</body>
</html>
