<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Haz tu Pedido - Miski Chukulati</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg,#3b2314,#5c3b1e,#7b4c22);
  color:#fff; margin:0; padding:0; text-align:center;
}
.container {
  max-width: 600px;
  margin: 40px auto;
  background: rgba(255,255,255,0.08);
  padding: 24px;
  border-radius: 16px;
  box-shadow: 0 0 15px rgba(212,175,55,0.3);
}
input, select, textarea {
  width: 100%;
  margin-top: 8px;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #d4c5b2;
  font-size: 1rem;
}
button {
  background: linear-gradient(90deg,#a67c52,#d4af37,#a67c52);
  color: #fff;
  font-weight: 600;
  border: none;
  padding: 12px 30px;
  border-radius: 30px;
  margin-top: 20px;
  cursor: pointer;
  transition: transform .3s, box-shadow .3s;
}
button:hover { transform: scale(1.05); box-shadow: 0 0 15px rgba(212,175,55,0.5); }

footer {
  margin-top: 40px;
  color: #f7e7ce;
  font-size: 0.9rem;
  text-align: center;
}
footer span {
  color: #f4d67b;
  font-style: italic;
}

/* POP-UP */
.popup {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  display: none;
  justify-content: center;
  align-items: center;
}
.popup-content {
  background: #fff;
  color: #3b2314;
  padding: 30px;
  border-radius: 16px;
  width: 90%;
  max-width: 400px;
  text-align: center;
  border: 2px solid #d4af37;
  box-shadow: 0 0 20px rgba(212,175,55,0.5);
  animation: fadeIn .4s ease-in-out;
}
@keyframes fadeIn {
  from { transform: scale(0.9); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}
</style>
</head>
<body>

<div class="container" id="pedidoForm">
  <h2>Haz tu pedido üç´</h2>

  <label>Nombre Completo</label>
  <input id="nombre" placeholder="Juan P√©rez">

  <label>DNI</label>
  <input id="dni" placeholder="8 d√≠gitos">

  <label>Correo</label>
  <input id="correo" type="email" placeholder="correo@ejemplo.com">

  <label>Celular</label>
  <input id="telefono" placeholder="9 d√≠gitos">

  <label>Direcci√≥n de entrega</label>
  <input id="direccion" placeholder="Av. Los Olivos 123">

  <label>Producto</label>
  <select id="producto" onchange="calcularTotal()">
    <option value="">--Selecciona--</option>
    <option value="Tableta 70 % cacao">Tableta 70 % cacao</option>
    <option value="Tableta 85 % cacao">Tableta 85 % cacao</option>
    <option value="Bombones surtidos">Bombones surtidos</option>
    <option value="Dark Chocolate Bar">Dark Chocolate Bar</option>
    <option value="ChocoNibs">ChocoNibs</option>
    <option value="ChocoBites">ChocoBites</option>
    <option value="Chocolate Blanco">Chocolate Blanco</option>
  </select>

  <label>Cantidad</label>
  <input id="cantidad" type="number" min="1" value="1" onchange="calcularTotal()">

  <label>M√©todo de pago</label>
  <select id="metodoPago">
    <option value="PLIN">PLIN</option>
    <option value="YAPE">YAPE</option>
    <option value="Transferencia">Transferencia</option>
    <option value="Efectivo">Efectivo</option>
  </select>

  <div style="margin-top:15px;">
    <label><input type="checkbox" id="toggleDelivery" onchange="calcularTotal()"> üöö Con delivery</label>
  </div>

  <button onclick="mostrarPopup()">Ver total</button>
</div>

<!-- POP-UP de confirmaci√≥n -->
<div class="popup" id="popup">
  <div class="popup-content">
    <h3>Resumen del pedido</h3>
    <p id="resumen"></p>
    <button onclick="enviarPedido()">Enviar pedido</button>
    <button onclick="cerrarPopup()" style="background:#999;color:#fff;margin-left:10px;">Cancelar</button>
  </div>
</div>

<footer>
  <span>"Jehov√° te bendiga, y te guarde‚Äù ‚Äì N√∫meros 6:24</span><br>
  ¬© Miski Chukulati - 2025
</footer>

<script>
const SCRIPT_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxISyjwQMZSoQ6XMR7JsUv3kG58WQwwizvFqeGUl203UuVWncDSYaKt02zVCw12Q-zgJg/exec";
const productosPrecios = {
  "Tableta 70 % cacao": 8.00,
  "Tableta 85 % cacao": 9.00,
  "Bombones surtidos": 15.00,
  "Dark Chocolate Bar": 8.00,
  "ChocoNibs": 5.00,
  "ChocoBites": 6.50,
  "Chocolate Blanco": 24.00
};
const envioFijo = 7;

function calcularTotal() {
  const producto = document.getElementById('producto').value;
  const cantidad = Number(document.getElementById('cantidad').value || 1);
  const precioUnitario = productosPrecios[producto] || 0;
  const delivery = document.getElementById('toggleDelivery').checked;
  const envio = delivery ? envioFijo : 0;
  const total = (precioUnitario * cantidad) + envio;

  document.getElementById('resumen').innerHTML =
    `Precio producto: S/ ${precioUnitario.toFixed(2)}<br>` +
    `Comisi√≥n env√≠o: S/ ${envio.toFixed(2)}<br><hr>` +
    `<strong>Total a pagar: S/ ${total.toFixed(2)}</strong>`;
}

function mostrarPopup() {
  calcularTotal();
  document.getElementById('popup').style.display = 'flex';
}
function cerrarPopup() {
  document.getElementById('popup').style.display = 'none';
}

async function enviarPedido() {
  const data = {
    type: "pedido",
    nombre: document.getElementById('nombre').value.trim(),
    dni: document.getElementById('dni').value.trim(),
    correo: document.getElementById('correo').value.trim(),
    telefono: document.getElementById('telefono').value.trim(),
    direccion: document.getElementById('direccion').value.trim(),
    producto: document.getElementById('producto').value,
    cantidad: Number(document.getElementById('cantidad').value || 1),
    metodoPago: document.getElementById('metodoPago').value,
    delivery: document.getElementById('toggleDelivery').checked
  };

  try {
    const resp = await fetch(SCRIPT_WEB_APP_URL, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(data)
    });

    const text = await resp.text();
    console.log("Respuesta del servidor:", text);

    let json;
    try { json = JSON.parse(text); }
    catch (e) { throw new Error("Respuesta no v√°lida: " + text); }

    if (json.success) {
      alert("‚úÖ Pedido enviado correctamente. ¬°Gracias por elegir Miski Chukulati!");
      document.getElementById('pedidoForm').reset();
      cerrarPopup();
    } else {
      alert("‚ö†Ô∏è Error: " + (json.error || "No se pudo registrar el pedido."));
    }
  } catch (err) {
    console.error("Error en fetch:", err);
    alert("‚ùå Error de conexi√≥n. Intenta nuevamente.");
  }
}
</script>
</body>
</html>
