<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pedidos - Miski Chukulati</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#3b2314,#5c3b1e,#7b4c22);color:#fff;margin:0;padding:0;text-align:center;}
.container{max-width:600px;margin:36px auto;background:rgba(255,255,255,0.08);padding:24px;border-radius:12px;box-shadow:0 0 12px rgba(212,175,55,0.3);}
input,select,button{padding:10px;border-radius:8px;border:none;width:100%;margin-top:6px;}
button{background:linear-gradient(90deg,#a67c52,#d4af37,#a67c52);color:#fff;font-weight:bold;cursor:pointer;}
button:hover{transform:scale(1.05);}
.total-popup{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);justify-content:center;align-items:center;}
.popup-box{background:#2b1c0d;padding:24px;border-radius:16px;border:2px solid #d4af37;max-width:400px;text-align:left;}
.popup-box h3{color:#f7e7ce;margin-bottom:16px;text-align:center;}
</style>
</head>
<body>

<img src="https://github.com/miskichukulati25-rgb/MiskiChukulati/blob/main/logo.png?raw=true" width="120" style="margin-top:20px;border-radius:50%;box-shadow:0 0 10px gold;">
<h1>Haz tu Pedido</h1>

<div class="container">
  <label>Nombre Completo</label>
  <input id="nombre">
  <label>DNI</label>
  <input id="dni">
  <label>Correo</label>
  <input id="correo" type="email">
  <label>Celular</label>
  <input id="telefono">
  <label>Producto</label>
  <select id="producto" onchange="calcularTotal()">
    <option value="">--Selecciona--</option>
    <option value="Tableta 70 % cacao">Tableta 70 % cacao</option>
    <option value="Tableta 85 % cacao">Tableta 85 % cacao</option>
    <option value="Bombones surtidos">Bombones surtidos</option>
    <option value="Chocolate Blanco">Chocolate Blanco</option>
  </select>
  <label>Cantidad</label>
  <input id="cantidad" type="number" min="1" value="1" onchange="calcularTotal()">

  <div style="margin-top:10px;">
    <label>¿Con delivery?</label>
    <input type="checkbox" id="delivery" onchange="calcularTotal()"> Sí
  </div>

  <button onclick="mostrarPopup()">Ver total</button>
</div>

<div class="total-popup" id="popup">
  <div class="popup-box">
    <h3>Resumen del pedido</h3>
    <p>Precio producto: S/ <span id="precioProducto">0.00</span></p>
    <p>Comisión delivery: S/ <span id="comision">0.00</span></p>
    <p><b>Total a pagar: S/ <span id="total">0.00</span></b></p>
    <button onclick="enviarPedido()">Enviar pedido</button>
  </div>
</div>

<script>
const SCRIPT_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw5TuK6rVuBmEisEVmJfQc0f0R5OYMTgvywBVifaiJySd4fWCmjXG1SfsCKbKqNmmZVAg/exec";
const productos = {"Tableta 70 % cacao":8,"Tableta 85 % cacao":9,"Bombones surtidos":15,"Chocolate Blanco":12};
const comision = 7;
let total = 0;

function calcularTotal(){
  const producto=document.getElementById('producto').value;
  const cantidad=parseInt(document.getElementById('cantidad').value||1);
  const conDelivery=document.getElementById('delivery').checked;
  const precio=productos[producto]||0;
  const subtotal=precio*cantidad;
  const envio=conDelivery?comision:0;
  total=subtotal+envio;
  document.getElementById('precioProducto').textContent=subtotal.toFixed(2);
  document.getElementById('comision').textContent=envio.toFixed(2);
  document.getElementById('total').textContent=total.toFixed(2);
}

function mostrarPopup(){
  calcularTotal();
  document.getElementById('popup').style.display='flex';
}

async function enviarPedido(){
  const data={
    nombre:document.getElementById('nombre').value.trim(),
    dni:document.getElementById('dni').value.trim(),
    correo:document.getElementById('correo').value.trim(),
    telefono:document.getElementById('telefono').value.trim(),
    producto:document.getElementById('producto').value,
    cantidad:document.getElementById('cantidad').value,
    conDelivery:document.getElementById('delivery').checked,
    total:total
  };
  try{
    const res=await fetch(SCRIPT_WEB_APP_URL,{method:'POST',body:JSON.stringify(data)});
    const json=await res.json();
    if(json.success){
      alert("Pedido confirmado. Gracias por elegirnos!");
      window.location.href="comprobante.html";
    }else alert("Error: "+json.error);
  }catch(e){alert("Error de conexión. Intenta nuevamente.");}
}
</script>

</body>
</html>
