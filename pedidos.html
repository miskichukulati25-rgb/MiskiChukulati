<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Haz tu Pedido - Miski Chukulati üç´</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap" rel="stylesheet">
<style>
body {
  font-family:'Poppins',sans-serif;
  background:linear-gradient(135deg,#3b2314,#5c3b1e,#7b4c22);
  color:#fff;margin:0;padding:0;text-align:center;
}
header {
  padding:12px 24px;background:rgba(0,0,0,0.5);
  display:flex;justify-content:space-between;align-items:center;
}
header h1{margin:0;font-size:1.5em}
.menu-btn{font-size:1.5em;cursor:pointer}
nav{
  position:absolute;top:50px;right:0;background:rgba(0,0,0,0.85);
  width:220px;display:none;flex-direction:column;border-radius:8px;margin:8px;
}
nav a{
  padding:12px 16px;color:#fff;text-decoration:none;border-bottom:1px solid #d4c5b2;
}
nav a:last-child{border-bottom:none}
nav a:hover{background:rgba(255,255,255,0.1)}

.container{
  max-width:600px;margin:30px auto;background:rgba(255,255,255,0.08);
  padding:24px;border-radius:12px;
}
.logo{
  width:120px;height:120px;border-radius:50%;
  margin-top:20px;
  box-shadow:0 0 20px rgba(212,175,55,0.4);
}

/* Campos */
label{display:block;margin-top:10px;font-weight:600;text-align:left}
input,select,textarea{
  padding:10px;border-radius:8px;border:1px solid #d4c5b2;
  width:100%;box-sizing:border-box;margin-top:4px;
}
textarea{resize:vertical}

/* Toggle */
.toggle-container{
  display:flex;align-items:center;gap:10px;
  background:rgba(255,255,255,0.08);
  padding:10px 20px;border-radius:40px;
  justify-content:center;margin-top:15px;
}
.toggle-switch{
  position:relative;width:55px;height:30px;
  background:#a67c52;border-radius:30px;
  cursor:pointer;transition:background 0.3s ease;
}
.toggle-switch::before{
  content:"";position:absolute;top:3px;left:3px;
  width:24px;height:24px;border-radius:50%;background:white;
  transition:transform 0.3s ease;
}
.toggle-switch.active{background:linear-gradient(90deg,#c7a86d,#e5c99c);}
.toggle-switch.active::before{transform:translateX(25px);}
.toggle-label{color:#f4d67b;font-weight:600}

/* Bot√≥n principal */
.order-btn{
  margin-top:20px;
  background:linear-gradient(90deg,#c7a86d,#e5c99c);
  border:none;padding:12px 30px;
  border-radius:30px;font-weight:700;
  color:#3b2314;cursor:pointer;
  font-size:1.1em;
  transition:transform 0.3s ease, box-shadow 0.3s ease;
}
.order-btn:hover{transform:scale(1.05);box-shadow:0 0 20px rgba(212,175,55,0.6);}

/* Popup */
.popup{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.75);
  display:flex;justify-content:center;align-items:center;
  visibility:hidden;opacity:0;
  transition:visibility 0s,opacity 0.3s ease;
}
.popup.active{visibility:visible;opacity:1;}
.popup-content{
  background:#fff8e1;color:#5c4033;
  border-radius:16px;padding:30px;text-align:center;
  max-width:320px;transform:scale(0.8);
  box-shadow:0 0 25px rgba(212,175,55,0.5);
  transition:transform 0.3s ease;
}
.popup.active .popup-content{transform:scale(1);}
.popup h2{color:#a67c52;}
.popup button{
  margin-top:18px;background:linear-gradient(90deg,#c7a86d,#e5c99c);
  border:none;padding:10px 20px;border-radius:25px;
  font-weight:700;color:#3b2314;cursor:pointer;
  transition:transform 0.2s ease;
}
.popup button:hover{transform:scale(1.05);box-shadow:0 0 15px rgba(212,175,55,0.6);}

/* Result */
.result{
  margin-top:18px;background:rgba(255,255,255,0.05);
  padding:12px;border-radius:8px;
}
footer{margin:25px 0;color:#d2b48c;font-size:0.9rem;}
footer span{color:#f4d67b;font-style:italic;}

/* Toast */
.toast{
  position:fixed;bottom:30px;left:50%;
  transform:translateX(-50%);
  background:rgba(212,175,55,0.95);
  color:#3b2314;
  padding:16px 24px;border-radius:30px;
  box-shadow:0 0 25px rgba(212,175,55,0.6);
  font-weight:700;opacity:0;
  transition:opacity 0.5s ease, bottom 0.5s ease;
}
.toast.show{opacity:1;bottom:50px;}
</style>
</head>
<body>

<header>
  <h1>Miski Chukulati üç´</h1>
  <div class="menu-btn" onclick="toggleMenu()">‚ò∞</div>
  <nav id="menuNav">
    <a href="#" onclick="showPedido()">Hacer Pedido</a>
    <a href="#" onclick="showOracion()">Pedido de Oraci√≥n</a>
  </nav>
</header>

<img src="https://github.com/miskichukulati25-rgb/MiskiChukulati/blob/main/logo.png?raw=true" alt="Logo Miski Chukulati" class="logo">

<div class="container" id="pedidoForm">
  <h2>Hacer Pedido</h2>

  <label>Nombre Completo</label>
  <input id="nombre" placeholder="Juan P√©rez">
  <label>DNI</label>
  <input id="dni" placeholder="8 d√≠gitos">
  <label>Correo</label>
  <input id="correo" type="email" placeholder="correo@ejemplo.com">
  <label>Celular</label>
  <input id="telefono" placeholder="9 d√≠gitos">

  <label>Producto</label>
  <select id="producto" onchange="calcularTotal()">
    <option value="">--Selecciona--</option>
    <option value="Tableta 70 % cacao">Tableta 70 % cacao</option>
    <option value="Tableta 85 % cacao">Tableta 85 % cacao</option>
    <option value="Bombones surtidos">Bombones surtidos</option>
    <option value="Dark Chocolate Bar">Dark Chocolate Bar</option>
    <option value="ChocoNibs">ChocoNibs</option>
    <option value="ChocoBites">ChocoBites</option>
    <option value="Chocolate Blanco">Chocolate Blanco</option>
  </select>

  <label>Cantidad</label>
  <input id="cantidad" type="number" min="1" value="1" onchange="calcularTotal()">

  <div class="toggle-container">
    <span class="toggle-label">Delivery</span>
    <div id="toggleDelivery" class="toggle-switch"></div>
    <span id="toggleStatus">Sin delivery</span>
  </div>

  <div class="total-box">
    <div>Precio Producto: S/ <span id="precioProducto">0.00</span></div>
    <div>Comisi√≥n Env√≠o: S/ <span id="comision">7.00</span></div>
    <div>Total: S/ <span id="total">0.00</span></div>
  </div>

  <button id="verTotalBtn" class="order-btn" onclick="mostrarPopup()">Ver total</button>

  <div id="result" class="result" style="display:none"></div>
</div>

<!-- Popup -->
<div id="popup" class="popup">
  <div class="popup-content">
    <h2>Confirmar Pedido</h2>
    <p><b>Producto:</b> <span id="popupProducto">-</span></p>
    <p><b>Cantidad:</b> <span id="popupCantidad">0</span></p>
    <p>Precio del producto: <b id="precioTxt">S/ 0.00</b></p>
    <p>Comisi√≥n de env√≠o: <b id="envioTxt">S/ 0.00</b></p>
    <p>Total a pagar: <b id="totalTxt">S/ 0.00</b></p>
    <button onclick="enviarPedido()">Enviar Pedido</button>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="toast"></div>

<footer>
  <span>"Jehov√° te bendiga, y te guarde‚Äù ‚Äì N√∫meros 6:24</span><br>
  ¬© Miski Chukulati - 2025
</footer>

<script>
const SCRIPT_WEB_APP_URL="https://script.google.com/macros/s/AKfycbypicbViQpx68de35No3yAEd2XoLHOQ5banZ8cmJjn15es3eus8K4rTM8sRtFoPaDiH/exec";
const productosPrecios={"Tableta 70 % cacao":8,"Tableta 85 % cacao":9,"Bombones surtidos":15,"Dark Chocolate Bar":8,"ChocoNibs":5,"ChocoBites":6.5,"Chocolate Blanco":24};
const envioFijo=7;
let conDelivery=false;
let lastPdfUrl=null;
let lastTracking=null;

function toggleMenu(){const nav=document.getElementById('menuNav');nav.style.display=(nav.style.display==='flex')?'none':'flex';}
function showPedido(){document.getElementById('pedidoForm').style.display='block';}
function showOracion(){document.getElementById('pedidoForm').style.display='none';}

const toggle=document.getElementById('toggleDelivery');
const statusText=document.getElementById('toggleStatus');
const popup=document.getElementById('popup');
const toast=document.getElementById('toast');

toggle.addEventListener('click',()=>{
  conDelivery=!conDelivery;
  toggle.classList.toggle('active');
  statusText.textContent=conDelivery?"Con delivery":"Sin delivery";
  calcularTotal();
});

function calcularTotal(){
  const producto=document.getElementById('producto').value;
  const cantidad=Number(document.getElementById('cantidad').value||1);
  const precioUnitario=productosPrecios[producto]||0;
  const subtotal=precioUnitario*cantidad;
  const comision=conDelivery?envioFijo:0;
  const total=subtotal+comision;
  document.getElementById('precioProducto').innerText=subtotal.toFixed(2);
  document.getElementById('comision').innerText=comision.toFixed(2);
  document.getElementById('total').innerText=total.toFixed(2);
  document.getElementById('popupProducto').innerText=producto||"-";
  document.getElementById('popupCantidad').innerText=cantidad;
  document.getElementById('precioTxt').innerText="S/ "+subtotal.toFixed(2);
  document.getElementById('envioTxt').innerText="S/ "+comision.toFixed(2);
  document.getElementById('totalTxt').innerText="S/ "+total.toFixed(2);
}

function mostrarPopup(){
  calcularTotal();
  popup.classList.add('active');
}

async function enviarPedido(){
  const data={
    type:"pedido",
    nombre:document.getElementById('nombre').value.trim(),
    dni:document.getElementById('dni').value.trim(),
    correo:document.getElementById('correo').value.trim(),
    telefono:document.getElementById('telefono').value.trim(),
    producto:document.getElementById('producto').value,
    cantidad:Number(document.getElementById('cantidad').value||1),
    delivery:conDelivery?"si":"no",
    envio:conDelivery?envioFijo:0
  };
  document.getElementById('result').style.display='block';
  document.getElementById('result').innerText='Enviando pedido...';
  popup.classList.remove('active');
  try{
    const res=await fetch(SCRIPT_WEB_APP_URL,{method:'POST',body:JSON.stringify(data)});
    const json=await res.json();
    if(json.success){
      lastPdfUrl=json.pdfUrl;
      lastTracking=json.tracking;
      document.getElementById('result').innerText='Gracias por tu compra...! Que Dios te gu√≠e y guarde siempre...!';
      showToast(`Pedido registrado exitosamente\nN√∫mero: ${lastTracking}`);
      const btn=document.getElementById('verTotalBtn');
      btn.textContent='üìÑ Comprobante de pedido';
      btn.onclick=()=>window.open(lastPdfUrl,'_blank');
    }else{
      document.getElementById('result').innerText='Error: '+json.error;
    }
  }catch(err){
    console.error(err);
    document.getElementById('result').innerText='Error al enviar pedido.';
  }
}

function showToast(msg){
  toast.innerText=msg;
  toast.classList.add('show');
  setTimeout(()=>toast.classList.remove('show'),6000);
}
</script>
</body>
</html>
