<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Haz tu Pedido | Miski Chukulati</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{--gold:#d4af37;--ivory:#fff8e7}
body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#3b2314,#5c3b1e,#7b4c22);color:var(--ivory);margin:0;padding:20px}
.container{max-width:620px;margin:38px auto;background:rgba(255,255,255,0.12);padding:28px;border-radius:14px;backdrop-filter:blur(6px);box-shadow:0 10px 30px rgba(0,0,0,.4)}
.logo{display:flex;justify-content:center;margin-bottom:12px}
.logo img{width:120px;height:120px;border-radius:50%;border:3px solid var(--gold);padding:6px;background:#fff8e7}
h1{text-align:center;margin:4px 0 12px}
label{display:block;margin-top:12px;font-weight:500}
input,select,textarea{width:100%;padding:10px;margin-top:6px;border-radius:6px;border:1px solid #d4c5b2;background:#fff;color:#333}
button{margin-top:20px;width:100%;padding:12px;border-radius:30px;border:none;background:linear-gradient(90deg,#c7a86d,#e5c99c);color:#3b2314;font-weight:700;cursor:pointer}
.msg{margin-top:14px;text-align:center;min-height:22px}
.toast{position:fixed;left:50%;bottom:26px;transform:translateX(-50%);background:rgba(60,35,20,0.96);color:var(--ivory);padding:12px 18px;border-radius:24px;box-shadow:0 6px 18px rgba(0,0,0,.4);z-index:999}
</style>
</head>
<body>

<div class="container">
  <div class="logo"><img src="https://github.com/miskichukulati25-rgb/MiskiChukulati/blob/main/logo.png?raw=true" alt="logo"></div>
  <h1>Miski Pedidos</h1>

  <form id="pedidoForm">
    <label for="dni">DNI</label>
    <input id="dni" name="dni" required maxlength="8" pattern="[0-9]{8}" title="DNI 8 dígitos">

    <label for="nombre">Nombre completo</label>
    <input id="nombre" name="nombre" required>

    <label for="correo">Correo</label>
    <input id="correo" name="correo" type="email" required>

    <label for="telefono">Teléfono (WhatsApp)</label>
    <input id="telefono" name="telefono" required pattern="[0-9]{9}" title="9 dígitos">

    <label for="producto">Producto</label>
    <select id="producto" name="producto" required>
      <option value="">Selecciona...</option>
      <option>Tableta de Chocolate con Leche</option>
      <option>Tableta de Chocolate Bitter 70%</option>
      <option>Bombones Surtidos (Caja 120g)</option>
      <option>Tableta de Chocolate Blanco</option>
      <option>Cacao en Polvo (200g)</option>
    </select>

    <label for="cantidad">Cantidad</label>
    <input id="cantidad" name="cantidad" type="number" min="1" value="1" required>

    <label for="metodoPago">Método de pago</label>
    <select id="metodoPago" name="metodoPago" required>
      <option value="">Selecciona...</option>
      <option>Yape</option><option>Plin</option><option>Transferencia</option><option>Efectivo</option>
    </select>

    <label for="direccion">Dirección</label>
    <input id="direccion" name="direccion">

    <label for="comentarios">Comentarios</label>
    <textarea id="comentarios" name="comentarios" rows="3"></textarea>

    <button id="submitBtn" type="submit">Enviar pedido</button>
  </form>

  <div id="msg" class="msg"></div>
</div>

<script>
/* REEMPLAZA esta URL por la tuya (Apps Script deploy /exec) */
const SCRIPT_WEB_APP_URL = "https://script.google.com/macros/s/AKfycby1fKrFq0RN-Zy6sl-WD6bgkth_czeAib0DFQqelDemEhEnOoHuz61e26-FHneEBTjjwA/exec";

const form = document.getElementById('pedidoForm');
const msg = document.getElementById('msg');
const btn = document.getElementById('submitBtn');

function toast(text){ const t=document.createElement('div'); t.className='toast'; t.textContent=text; document.body.appendChild(t); setTimeout(()=>t.remove(),3200); }

form.addEventListener('submit', async e=>{
  e.preventDefault();
  btn.disabled=true; msg.innerHTML='⏳ Enviando pedido...';
  const data = Object.fromEntries(new FormData(form).entries());

  try {
    const res = await fetch(SCRIPT_WEB_APP_URL, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(data),
      mode:'cors'
    });
    const text = await res.text();
    let json;
    try { json = JSON.parse(text); } catch { json = null; }
    if (json && json.success) {
      msg.innerHTML = <span style="color:#b8ffb8">✅ Pedido ${json.idPedido || ''} registrado. Revisa tu correo.</span>;
      toast('✅ Pedido recibido');
      form.reset();
      setTimeout(()=>window.location.href='index.html',3200);
    } else {
      const err = (json && json.error) ? json.error : 'Error al registrar pedido';
      msg.innerHTML = <span style="color:#ffcccc">❌ ${err}</span>;
      toast('❌ Error registrando pedido');
      btn.disabled=false;
    }
  } catch(err) {
    console.error(err);
    msg.innerHTML = <span style="color:#ffcccc">⚠️ No se pudo conectar con el servidor.</span>;
    toast('⚠️ Error de conexión');
    btn.disabled=false;
  }
});
</script>
</body>
</html>
