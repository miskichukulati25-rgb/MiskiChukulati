<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Seguimiento - Miski Chukulati</title>
<style>
body{font-family:Poppins, sans-serif;background:linear-gradient(135deg,#3b2314,#5c3b1e);color:#fff;padding:24px}
.container{max-width:760px;margin:24px auto;background:rgba(255,255,255,0.05);padding:18px;border-radius:12px}
input,button{padding:10px;border-radius:8px;border:1px solid rgba(212,197,178,0.12);width:100%;box-sizing:border-box;margin-top:8px}
.result{margin-top:12px;background:rgba(255,255,255,0.03);padding:12px;border-radius:8px;color:#fff;text-align:left}
button.primary{background:linear-gradient(90deg,#a67c52,#d4af37);border:none;color:#3b2314;font-weight:700}
</style>
</head>
<body>
<div class="container">
  <h2>Seguimiento de Pedido</h2>
  <label>ID de Pedido</label><input id="idPedido" placeholder="MSK-2025-001">
  <label>O DNI</label><input id="dni" placeholder="DNI 8 dÃ­gitos">
  <button class="primary" onclick="buscar()">Buscar</button>
  <div id="result" class="result" style="display:none"></div>
</div>

<script>
const SCRIPT_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxISyjwQMZSoQ6XMR7JsUv3kG58WQwwizvFqeGUl203UuVWncDSYaKt02zVCw12Q-zgJg/exec";
async function buscar(){
  const id = document.getElementById('idPedido').value.trim();
  const dni = document.getElementById('dni').value.trim();
  const resDiv = document.getElementById('result');
  resDiv.style.display='block'; resDiv.innerText='Buscando...';
  try {
    const params = new URLSearchParams({ action:'trackOrder', idPedido: id, dni: dni });
    const res = await fetch(SCRIPT_WEB_APP_URL + '?' + params.toString());
    const json = await res.json();
    if (json.success && json.order) {
      const o = json.order;
      resDiv.innerHTML = `<b>Tracking:</b> ${o['Tracking']}<br>
                          <b>Fecha / Hora:</b> ${formatDate(o['Fecha / Hora'])}<br>
                          <b>DNI:</b> ${o['DNI']}<br>
                          <b>Nombre:</b> ${o['Nombre Completo']}<br>
                          <b>Producto:</b> ${o['Producto']} x ${o['Cantidad']}<br>
                          <b>Total:</b> S/ ${o['Total (S/.)'] || o['Total'] || 'â€”'}<br>
                          <b>Estado:</b> ${o['Estado'] || 'â€”'}<br>
                          ${o['Link PDF'] ? `<a href="${o['Link PDF']}" target="_blank" style="color:#ffdca8">ðŸ“„ Descargar comprobante</a>` : ''}`;
    } else resDiv.innerText = 'Pedido no encontrado.';
  } catch(e){
    console.error(e);
    resDiv.innerText = 'Error de conexiÃ³n.';
  }
}
function formatDate(v){
  try { return new Date(v).toLocaleString(); } catch(e){ return v; }
}
</script>
</body>
</html>
