<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seguimiento de Pedido - Miski Chukulati üç´</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, #3b2314, #5c3b1e, #7b4c22);
  color: #fff;
  margin: 0;
  padding: 0;
  text-align: center;
  min-height: 100vh;
}

header {
  background: rgba(0, 0, 0, 0.5);
  padding: 14px;
  font-weight: 600;
  color: #f4d67b;
  letter-spacing: 1px;
}

.container {
  max-width: 750px;
  margin: 30px auto;
  background: rgba(255, 255, 255, 0.08);
  padding: 30px;
  border-radius: 16px;
  box-shadow: 0 0 25px rgba(212,175,55,0.3);
}

.logo {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  margin-bottom: 15px;
  box-shadow: 0 0 20px rgba(212,175,55,0.5);
}

h2 {
  color: #f7e7ce;
  margin-bottom: 10px;
}

.info-box {
  background: rgba(255, 255, 255, 0.12);
  border-radius: 12px;
  padding: 20px;
  text-align: left;
  color: #fff8dc;
}

.info-box strong {
  color: #f4d67b;
}

.status {
  font-weight: 700;
  color: #f4d67b;
}

.rider-card {
  background: rgba(255,255,255,0.12);
  border-radius: 15px;
  padding: 15px;
  text-align: center;
  margin-top: 20px;
  box-shadow: 0 0 15px rgba(212,175,55,0.4);
}

.rider-card img {
  width: 90px;
  height: 90px;
  border-radius: 50%;
  border: 2px solid #d4af37;
  object-fit: cover;
}

.rider-name {
  font-weight: 600;
  color: #f4d67b;
  margin-top: 8px;
}

.rider-rating {
  font-size: 1.2em;
  color: #ffd700;
  transition: transform 0.3s ease;
}

.rider-card:hover .rider-rating {
  transform: scale(1.2);
}

.download-btn {
  display: inline-block;
  margin-top: 25px;
  background: linear-gradient(90deg, #c7a86d, #e5c99c);
  padding: 12px 28px;
  border-radius: 30px;
  text-decoration: none;
  font-weight: 700;
  color: #3b2314;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}
.download-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 0 20px rgba(212,175,55,0.6);
}

footer {
  margin-top: 35px;
  color: #e0c68b;
  font-size: 0.9rem;
}
footer span {
  color: #f4d67b;
  font-style: italic;
}
</style>
</head>
<body>
<header>Seguimiento de Pedido</header>

<div class="container">
  <img src="https://github.com/miskichukulati25-rgb/MiskiChukulati/blob/main/logo.png?raw=true" alt="Logo Miski Chukulati" class="logo">
  <h2>Estado de tu Pedido</h2>
  <div id="orderDetails" class="info-box">Cargando informaci√≥n...</div>

  <div id="riderInfo" class="rider-card" style="display:none">
    <img id="riderPhoto" src="" alt="Rider">
    <div class="rider-name" id="riderName"></div>
    <div class="rider-rating" id="riderRating"></div>
  </div>

  <a id="pdfLink" class="download-btn" href="#" target="_blank" style="display:none;">üìÑ Descargar Comprobante</a>
</div>

<footer>
  <span>"Jehov√° te bendiga, y te guarde‚Äù ‚Äì N√∫meros 6:24</span><br>
  ¬© Miski Chukulati - 2025
</footer>

<script>
const SCRIPT_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbypicbViQpx68de35No3yAEd2XoLHOQ5banZ8cmJjn15es3eus8K4rTM8sRtFoPaDiH/exec";

async function loadOrder() {
  const params = new URLSearchParams(window.location.search);
  const idPedido = params.get("idPedido");
  if (!idPedido) {
    document.getElementById('orderDetails').innerHTML = "‚ùå No se proporcion√≥ un n√∫mero de pedido.";
    return;
  }

  try {
    const res = await fetch(`${SCRIPT_WEB_APP_URL}?action=trackOrder&idPedido=${encodeURIComponent(idPedido)}`);
    const data = await res.json();

    if (data.success && data.order) {
      const o = data.order;
      let html = `
        <p><strong>N√∫mero de Pedido:</strong> ${o.idPedido}</p>
        <p><strong>Fecha/Hora:</strong> ${o.fecha}</p>
        <p><strong>Cliente:</strong> ${o.nombre}</p>
        <p><strong>Producto:</strong> ${o.producto} (x${o.cantidad})</p>
        <p><strong>Total:</strong> S/ ${o.total}</p>
        <p><strong>Estado:</strong> <span class="status">${o.estado}</span></p>
      `;
      document.getElementById("orderDetails").innerHTML = html;

      if (o.pdfUrl) {
        const link = document.getElementById("pdfLink");
        link.href = o.pdfUrl;
        link.style.display = "inline-block";
      }

      if (o.encargadoEnvio) {
        const riderCard = document.getElementById("riderInfo");
        document.getElementById("riderName").textContent = o.encargadoEnvio;
        document.getElementById("riderPhoto").src = o.fotoRider || "https://via.placeholder.com/90";
        document.getElementById("riderRating").textContent = `‚≠ê ${o.calificacion || 5}`;
        riderCard.style.display = "block";
      }

    } else {
      document.getElementById('orderDetails').innerHTML = "‚ùå Pedido no encontrado. Verifica el n√∫mero de pedido.";
    }
  } catch (err) {
    console.error(err);
    document.getElementById('orderDetails').innerHTML = "‚ö†Ô∏è Error al cargar los datos del pedido.";
  }
}

loadOrder();
</script>
</body>
</html>
