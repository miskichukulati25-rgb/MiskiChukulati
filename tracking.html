<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Seguimiento - Miski Chukulati üç´</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg,#3b2314,#5c3b1e,#7b4c22);
  color: #fff;
  padding: 22px;
  margin: 0;
}

.container {
  max-width: 820px;
  margin: 36px auto;
  background: rgba(255,255,255,0.08);
  padding: 24px;
  border-radius: 12px;
  text-align: center;
}

label {
  display: block;
  margin-top: 10px;
  font-weight: 600;
  text-align: left;
}

input, button {
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #d4c5b2;
  width: 100%;
}

button {
  margin-top: 12px;
  background: linear-gradient(90deg,#c7a86d,#e5c99c);
  color: #3b2314;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}

button:hover {
  transform: scale(1.03);
}

.result {
  margin-top: 18px;
  background: rgba(255,255,255,0.15);
  padding: 18px;
  border-radius: 10px;
  color: #fffbe7;
  line-height: 1.6;
}

.qr {
  margin-top: 14px;
}

a.download {
  display: inline-block;
  margin-top: 14px;
  padding: 10px 16px;
  border-radius: 24px;
  background: linear-gradient(90deg,#c7a86d,#e5c99c);
  color: #3b2314;
  text-decoration: none;
  font-weight: 700;
}
</style>
</head>
<body>
<div class="container">
  <h2>üì¶ Seguimiento de Pedido</h2>
  <p>Busca por <b>ID de pedido</b> (P...) o por <b>DNI</b></p>

  <label>ID de Pedido</label>
  <input id="idPedido" placeholder="P2025..." />

  <label style="margin-top:8px">O DNI</label>
  <input id="dni" placeholder="DNI 8 d√≠gitos" />

  <button id="btnSearch">Buscar</button>

  <div id="result" class="result" style="display:none"></div>
</div>

<script>
const SCRIPT_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbypicbViQpx68de35No3yAEd2XoLHOQ5banZ8cmJjn15es3eus8K4rTM8sRtFoPaDiH/exec";
const btn = document.getElementById('btnSearch');
const result = document.getElementById('result');

btn.addEventListener('click', async ()=>{
  result.style.display = 'block';
  result.innerHTML = 'üîé Buscando...';
  
  const idPedido = document.getElementById('idPedido').value.trim();
  const dni = document.getElementById('dni').value.trim();
  
  if(!idPedido && !dni){
    result.innerHTML = '‚ö†Ô∏è Ingresa ID o DNI.';
    return;
  }

  try {
    const params = new URLSearchParams();
    params.append('action','trackOrder');
    if(idPedido) params.append('idPedido', idPedido);
    else params.append('dni', dni);

    const res = await fetch(`${SCRIPT_WEB_APP_URL}?${params.toString()}`, {method:'GET', mode:'cors'});
    const json = await res.json();

    if(json.success && json.order){
      const o = json.order;
      const comprobante = o.pdfUrl ? `<a class="download" href="${o.pdfUrl}" target="_blank">üìÑ Descargar comprobante</a>` : '';
      const qrImg = o.pdfUrl ? `<div class="qr"><img src="https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=${encodeURIComponent(o.pdfUrl)}" alt="QR Comprobante" width="140"></div>` : '';
      
      result.innerHTML = `
        <strong>ID:</strong> ${o.idPedido}<br>
        <strong>Estado:</strong> ${o.estado}<br>
        <strong>Cliente:</strong> ${o.nombre}<br>
        <strong>Producto:</strong> ${o.producto} (x${o.cantidad})<br>
        <strong>Direcci√≥n:</strong> ${o.direccion || '‚Äî'}<br>
        ${comprobante}
        ${qrImg}
      `;
    } else {
      result.innerHTML = '‚ùå Pedido no encontrado.';
    }
  } catch(err){
    console.error(err);
    result.innerHTML = '‚ö†Ô∏è Error de conexi√≥n al consultar pedido.';
  }
});
</script>
</body>
</html>
