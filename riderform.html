<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Formulario Miski Rider - Miski Chukulati</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{--brown:#3b2314;--gold:#d4af37;--cream:#fff8f0}
  body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#3b2314,#5c3b1e);color:#fff;margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
  .card{background:rgba(255,255,255,0.04);border-radius:14px;padding:20px;max-width:760px;width:100%;box-shadow:0 10px 30px rgba(0,0,0,0.45)}
  .logo-wrap{text-align:center;margin-bottom:8px}
  .logo{width:110px;height:110px;border-radius:50%;box-shadow:0 8px 30px rgba(212,175,55,0.25);border:4px solid rgba(212,175,55,0.08)}
  h1{text-align:center;color:#f7e7ce;margin:8px 0 6px}
  p.lead{text-align:center;color:#e9d7a1;margin:0 0 12px}
  form{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  label{display:block;font-weight:600;font-size:0.9rem;color:#f3e8dc;margin-bottom:6px}
  input,textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(212,197,178,0.12);background:rgba(255,255,255,0.03);color:#fff;box-sizing:border-box}
  textarea{min-height:100px;resize:vertical}
  .full{grid-column:1/3}
  .files{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .hint{font-size:0.82rem;color:#e0c68b;margin-top:6px}
  .actions{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
  .btn{background:linear-gradient(90deg,#a67c52,#d4af37);color:#3b2314;padding:10px 16px;border-radius:10px;border:none;font-weight:700;cursor:pointer}
  .btn.secondary{background:transparent;color:#f3e8dc;border:1px solid rgba(243,232,220,0.06)}
  .notice{background:rgba(0,0,0,0.18);padding:10px;border-radius:8px;color:#ffdca8;margin-top:12px}
  @media (max-width:720px){form{grid-template-columns:1fr} .full{grid-column:1/2}}
</style>
</head>
<body>
  <div class="card" role="main" aria-labelledby="title">
    <div class="logo-wrap">
      <img src="https://github.com/miskichukulati25-rgb/MiskiChukulati/blob/main/logo.png?raw=true" alt="Miski Chukulati logo" class="logo">
    </div>

    <h1 id="title">Sé un Miski Rider</h1>
    <p class="lead">Únete a nuestra familia de reparto con integridad, servicio y alegría.</p>

    <form id="riderForm" enctype="multipart/form-data" onsubmit="handleSubmit(event)">
      <div>
        <label for="nombre">Nombre completo *</label>
        <input id="nombre" name="nombre" required>
      </div>
      <div>
        <label for="dni">DNI *</label>
        <input id="dni" name="dni" required pattern="\d{6,12}" title="Solo números">
      </div>

      <div>
        <label for="edad">Edad</label>
        <input id="edad" name="edad" type="number" min="18" max="80">
      </div>
      <div>
        <label for="correo">Correo electrónico *</label>
        <input id="correo" name="correo" type="email" required>
      </div>

      <div>
        <label for="telefono">Teléfono / Celular *</label>
        <input id="telefono" name="telefono" required>
      </div>
      <div>
        <label for="direccion">Dirección</label>
        <input id="direccion" name="direccion">
      </div>

      <div class="full">
        <label for="mensaje">¿Por qué deseas ser Miski Rider?</label>
        <textarea id="mensaje" name="mensaje" placeholder="Cuéntanos tu motivación, experiencia y disponibilidad..."></textarea>
      </div>

      <div class="full">
        <label>Documentos obligatorios (sube archivos PDF o imagenes JPEG/PNG) *</label>
        <div class="files">
          <div>
            <label for="fileDNI">DNI (foto o PDF)</label>
            <input id="fileDNI" type="file" accept="image/*,application/pdf">
          </div>
          <div>
            <label for="fileAntecedentes">Antecedentes policiales</label>
            <input id="fileAntecedentes" type="file" accept="image/*,application/pdf">
          </div>
          <div>
            <label for="fileContrato">Contrato firmado (locación)</label>
            <input id="fileContrato" type="file" accept="image/*,application/pdf">
          </div>
          <div>
            <label for="fileFoto">Foto personal (nítida)</label>
            <input id="fileFoto" type="file" accept="image/*">
          </div>
          <div>
            <label for="fileMedico">Certificado médico</label>
            <input id="fileMedico" type="file" accept="image/*,application/pdf">
          </div>
        </div>
        <div class="hint">Los archivos serán guardados en tu carpeta segura de postulantes.</div>
      </div>

      <div class="full">
        <label>
          <input id="confirm" type="checkbox" required> Confirmo que la información enviada es veraz y me comprometo a representar a Miski Chukulati con respeto y puntualidad.
        </label>
      </div>

      <div class="actions full">
        <button type="button" class="btn secondary" onclick="resetForm()">Limpiar</button>
        <button type="submit" class="btn">Enviar postulación</button>
      </div>

      <div id="status" class="full" style="display:none"></div>
    </form>

    <div class="notice" id="notice" style="display:none"></div>
  </div>

<script>
const SCRIPT_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw5TuK6rVuBmEisEVmJfQc0f0R5OYMTgvywBVifaiJySd4fWCmjXG1SfsCKbKqNmmZVAg/exec";
const adminEmail = "Miskichukulati25@gmail.com";

function resetForm(){
  document.getElementById('riderForm').reset();
  document.getElementById('status').style.display='none';
  document.getElementById('notice').style.display='none';
}

async function handleSubmit(ev){
  ev.preventDefault();
  const form = document.getElementById('riderForm');
  const status = document.getElementById('status');
  const notice = document.getElementById('notice');

  status.style.display='block'; status.innerText = 'Preparando archivos...';
  notice.style.display='none';

  const nombre = document.getElementById('nombre').value.trim();
  const dni = document.getElementById('dni').value.trim();
  const edad = document.getElementById('edad').value.trim();
  const correo = document.getElementById('correo').value.trim();
  const telefono = document.getElementById('telefono').value.trim();
  const direccion = document.getElementById('direccion').value.trim();
  const mensaje = document.getElementById('mensaje').value.trim();

  // Prepare files (convert to base64)
  const filesToRead = [
    {id:'fileDNI', key:'dniFile'},
    {id:'fileAntecedentes', key:'antecedentesFile'},
    {id:'fileContrato', key:'contratoFile'},
    {id:'fileFoto', key:'fotoFile'},
    {id:'fileMedico', key:'medicoFile'}
  ];

  const filesPayload = [];

  try {
    for(const f of filesToRead){
      const input = document.getElementById(f.id);
      if(input && input.files && input.files.length>0){
        const file = input.files[0];
        const base64 = await fileToBase64(file);
        filesPayload.push({
          field: f.key,
          filename: file.name,
          mimeType: file.type || 'application/octet-stream',
          base64: base64.split(',').pop() // remove data:...;base64, prefix
        });
      }
    }
  } catch(err){
    status.innerText = 'Error leyendo archivos: ' + err.message;
    return;
  }

  // build payload
  const payload = {
    type: 'rider',
    nombre, dni, edad, correo, telefono, direccion, mensaje,
    files: filesPayload
  };

  status.innerText = 'Enviando postulación...';
  try {
    const resp = await fetch(SCRIPT_WEB_APP_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    const json = await resp.json();
    if(json.success){
      status.innerHTML = `¡Postulación enviada! <br>Tu número de referencia: <strong>${json.ref}</strong>`;
      notice.style.display='block';
      notice.innerHTML = `Hemos notificado al equipo. Recibirás confirmación al correo: <strong>${correo}</strong>`;
      form.reset();
    } else {
      status.innerText = 'Error: ' + (json.error || 'No se pudo enviar la postulación.');
    }
  } catch(err){
    status.innerText = 'Error de conexión: ' + err.message;
  }
}

// helper: file -> dataURL
function fileToBase64(file){
  return new Promise((resolve,reject)=>{
    const fr = new FileReader();
    fr.onload = ()=> resolve(fr.result);
    fr.onerror = ()=> reject(new Error('No se pudo leer el archivo.'));
    fr.readAsDataURL(file);
  });
}
</script>
</body>
</html>
