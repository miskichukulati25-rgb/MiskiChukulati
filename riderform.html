<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Postulación Miski Rider</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#3b2314,#5c3b1e);color:#fff;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
.card{background:rgba(255,255,255,0.04);padding:18px;border-radius:12px;max-width:820px;width:100%}
.logo{display:block;margin:0 auto 8px;width:110px;border-radius:50%}
label{display:block;margin-top:10px;font-weight:600}
input,textarea,select,button{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(212,197,178,0.12);background:transparent;color:#fff;margin-top:6px}
.files{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.btn{background:linear-gradient(90deg,#a67c52,#d4af37);color:#3b2314;border:none;padding:10px;border-radius:10px;cursor:pointer}
.note{color:#ffdca8;margin-top:10px}
@media(max-width:720px){.files{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="card" role="main">
  <img class="logo" src="https://github.com/miskichukulati25-rgb/MiskiChukulati/blob/main/logo.png?raw=true" alt="logo">
  <h2 style="text-align:center">Sé un Miski Rider</h2>
  <form id="frm" onsubmit="submitForm(event)">
    <label>Nombre completo *</label><input id="nombre" required>
    <label>DNI *</label><input id="dni" required>
    <label>Edad</label><input id="edad" type="number">
    <label>Correo *</label><input id="correo" type="email" required>
    <label>Teléfono *</label><input id="telefono" required>
    <label>Dirección</label><input id="direccion">
    <label>Motivación (¿por qué deseas ser Miski Rider?)</label><textarea id="mensaje"></textarea>

    <label>Documentos (DNI, Antecedentes, Contrato, Foto, Cert. Médico)</label>
    <div class="files">
      <input id="fileDNI" type="file" accept="image/*,application/pdf">
      <input id="fileAntecedentes" type="file" accept="image/*,application/pdf">
      <input id="fileContrato" type="file" accept="image/*,application/pdf">
      <input id="fileFoto" type="file" accept="image/*">
      <input id="fileMedico" type="file" accept="image/*,application/pdf">
    </div>

    <div class="note">Tus archivos serán guardados de forma segura. Serás notificado por correo.</div>
    <div style="display:flex;gap:8px;margin-top:12px">
      <button type="button" class="btn" onclick="document.getElementById('frm').reset()">Limpiar</button>
      <button type="submit" class="btn">Enviar postulación</button>
    </div>
    <div id="status" style="margin-top:12px"></div>
  </form>
</div>

<script>
const SCRIPT_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxISyjwQMZSoQ6XMR7JsUv3kG58WQwwizvFqeGUl203UuVWncDSYaKt02zVCw12Q-zgJg/exec";
async function submitForm(e){
  e.preventDefault();
  const status = document.getElementById('status'); status.innerText='Preparando...';
  const ids = ['fileDNI','fileAntecedentes','fileContrato','fileFoto','fileMedico'];
  const files = [];
  for (const id of ids) {
    const input = document.getElementById(id);
    if (input && input.files && input.files[0]) {
      const f = input.files[0];
      const b64 = await fileToBase64(f);
      files.push({ field: id, filename: f.name, mimeType: f.type, base64: b64.split(',').pop() });
    }
  }
  const payload = {
    type: 'rider',
    nombre: document.getElementById('nombre').value.trim(),
    dni: document.getElementById('dni').value.trim(),
    edad: document.getElementById('edad').value.trim(),
    correo: document.getElementById('correo').value.trim(),
    telefono: document.getElementById('telefono').value.trim(),
    direccion: document.getElementById('direccion').value.trim(),
    mensaje: document.getElementById('mensaje').value.trim(),
    files: files
  };
  status.innerText='Enviando postulación...';
  try {
    const res = await fetch(SCRIPT_WEB_APP_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
    const json = await res.json();
    if (json.success) {
      status.innerHTML = `Postulación enviada. Ref: <strong>${json.ref}</strong>. Recibirás noticias por correo.`;
      document.getElementById('frm').reset();
    } else {
      status.innerText = 'Error: ' + (json.error || 'No se pudo enviar');
    }
  } catch(err) {
    status.innerText = 'Error de conexión: ' + err.message;
  }
}

function fileToBase64(file){
  return new Promise((resolve,reject)=>{
    const fr = new FileReader();
    fr.onload = ()=> resolve(fr.result);
    fr.onerror = ()=> reject(new Error('No se pudo leer archivo'));
    fr.readAsDataURL(file);
  });
}
</script>
</body>
</html>
